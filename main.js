!function(t){var e={};function n(o){if(e[o])return e[o].exports;var r=e[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(o,r,function(e){return t[e]}.bind(null,r));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="docs",n(n.s=2)}([function(t,e,n){"use strict";n.r(e),n.d(e,"NUM_ROW",(function(){return o})),n.d(e,"NUM_COLUMN",(function(){return r})),n.d(e,"PIXEL_SIZE",(function(){return i})),n.d(e,"SQUARE_SIZE",(function(){return a})),n.d(e,"BOARD_HEIGHT",(function(){return s})),n.d(e,"BOARD_WIDTH",(function(){return c})),n.d(e,"DISPLAY_FULL_WIDTH",(function(){return u})),n.d(e,"BOARD_TOP_MARGIN",(function(){return l})),n.d(e,"NEXT_BOX_WIDTH",(function(){return d})),n.d(e,"VACANT",(function(){return f})),n.d(e,"RED_COLOR",(function(){return h})),n.d(e,"BLUE_COLOR",(function(){return S})),n.d(e,"WHITE_COLOR",(function(){return E})),n.d(e,"SquareState",(function(){return g})),n.d(e,"COLOR_1",(function(){return p})),n.d(e,"COLOR_2",(function(){return I})),n.d(e,"COLOR_3",(function(){return m})),n.d(e,"COLOR_PALETTE",(function(){return _})),n.d(e,"Direction",(function(){return R})),n.d(e,"REWARDS",(function(){return L})),n.d(e,"CalculatePushdownPoints",(function(){return A})),n.d(e,"GetGravity",(function(){return T})),n.d(e,"GameState",(function(){return D})),n.d(e,"LINE_CLEAR_DELAY",(function(){return U}));const o=20,r=10,i=3,a=8*i,s=a*o,c=a*r,u=a*(r+6),l=2*a,d=5*a,f="black",h="red",S="#2105f2",E="white",g={EMPTY:0,COLOR1:1,COLOR2:2,COLOR3:3},p={0:"rgb(0,88,248)",1:"rgb(0,168,0)",2:"rgb(216,0,204)",3:"rgb(0,88,248)",4:"rgb(228,0,88",5:"rgb(88,248,152)",6:"rgb(248,56,0)",7:"rgb(104,68,252)",8:"rgb(0,88,248)",9:"rgb(248,56,0)"},I={0:"rgb(60,188,252)",1:"rgb(148,248,24)",2:"rgb(248,120,248)",3:"rgb(88,216,84)",4:"rgb(88,248,152)",5:"rgb(104,136,252)",6:"rgb(124,124,124)",7:"rgb(168,0,32)",8:"rgb(248,56,0)",9:"rgb(252,160,68)"},m=Object.assign(p),_={1:p,2:I,3:m},R=Object.freeze({LEFT:1,RIGHT:2,DOWN:3,UP:4}),L={1:40,2:100,3:300,4:1200},y={0:48,1:43,2:38,3:33,4:28,5:23,6:18,7:13,8:8,9:6,10:5,11:5,12:5,13:4,14:4,15:4,16:3,17:3,18:3,19:2,29:1};function A(t){return t>=16?t-6:t}function T(t){return t<=18?y[t]:t<29?2:1}const D={FIRST_PIECE:"first piece",RUNNING:"running",PAUSED:"paused",GAME_OVER:"game over",START_SCREEN:"start screen",ARE:"are",LINE_CLEAR:"line clear"},U=18},function(t,e,n){"use strict";function o(){return!1}function r(){return!1}function i(){return!1}function a(){return!0}function s(){return 0}function c(){return 10}function u(){return 16}n.r(e),n.d(e,"IsDASAlwaysCharged",(function(){return o})),n.d(e,"ShouldTransitionEvery10Lines",(function(){return r})),n.d(e,"ShouldTransitionEveryLine",(function(){return i})),n.d(e,"ShouldShowDiggingHints",(function(){return a})),n.d(e,"GetDASUnchargedFloor",(function(){return s})),n.d(e,"GetDASChargedFloor",(function(){return c})),n.d(e,"GetDASTriggerThreshold",(function(){return u}))},function(t,e,n){"use strict";n.r(e),n.d(e,"GetCurrentPiece",(function(){return St})),n.d(e,"GetLevel",(function(){return Et}));const o={Z:[[[[0,0,0,0],[0,1,1,0],[0,0,1,1]],[[0,0,0,1],[0,0,1,1],[0,0,1,0]]],2,"Z"],S:[[[[0,0,0,0],[0,0,1,1],[0,1,1,0]],[[0,0,1,0],[0,0,1,1],[0,0,0,1]]],3,"S"],T:[[[[0,0,0,0],[0,1,1,1],[0,0,1,0]],[[0,0,1,0],[0,1,1,0],[0,0,1,0]],[[0,0,1,0],[0,1,1,1],[0,0,0,0]],[[0,0,1,0],[0,0,1,1],[0,0,1,0]]],1,"T"],O:[[[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]]],1,"O"],L:[[[[0,0,0,0],[0,1,1,1],[0,1,0,0]],[[0,1,1,0],[0,0,1,0],[0,0,1,0]],[[0,0,0,1],[0,1,1,1],[0,0,0,0]],[[0,0,1,0],[0,0,1,0],[0,0,1,1]]],2,"L"],I:[[[[0,0,0,0],[0,0,0,0],[1,1,1,1],[0,0,0,0]],[[0,0,1,0],[0,0,1,0],[0,0,1,0],[0,0,1,0]]],1,"I"],J:[[[[0,0,0,0],[0,1,1,1],[0,0,0,1]],[[0,0,1,0],[0,0,1,0],[0,1,1,0]],[[0,1,0,0],[0,1,1,1],[0,0,0,0]],[[0,0,1,1],[0,0,1,0],[0,0,1,0]]],3,"J"]},r=Object.values(o),i=document.getElementById("piece-sequence");let a="",s=0,c=!1;function u(){}u.prototype.startReadingPieceSequence=function(){a=i.value.replace(/ /g,""),a.length>0&&(c=!0,s=0)},u.prototype.chooseNextPiece=function(t){return c?this.getPresetPiece():(c=!1,this.getRandomPiece(t))},u.prototype.getStatusDisplay=function(){return c?["Piece ",s+1+"/"+a.length]:["Random","Piece"]},u.prototype.getPresetPiece=function(){const t=a[s],e=o[t];return s+=1,s>=a.length&&(c=!1,s=0),e},u.prototype.getRandomPiece=function(t){let e=Math.floor(Math.random()*(r.length+1));e!=r.length&&t!==r[e][2]||(e=Math.floor(Math.random()*r.length));return r[e]};var l=n(0);const d=document.getElementById("paste-area"),f=document.getElementById("pasted-image");let h=!1,S=[];function E(t,e){var n;this.board=t,this.canvas=e,n=this,d.onpaste=function(t){for(var e=(t.clipboardData||t.originalEvent.clipboardData).items,o=null,r=0;r<e.length;r++)0===e[r].type.indexOf("image")&&(o=e[r].getAsFile());if(null!==o){var i=new FileReader;i.onload=function(t){f.onload=function(){n.getBoardStateFromImage(f)},f.src=t.target.result},i.readAsDataURL(o)}}}E.prototype.resetBoard=function(){for(let t=0;t<l.NUM_ROW;t++)for(let e=0;e<l.NUM_COLUMN;e++)this.board[t][e]=h?S[t][e]:l.SquareState.EMPTY},E.prototype.didLoadBoardStateFromImage=function(){return h},E.prototype.getBoardStateFromImage=function(t){var e=document.getElementById("dummy-canvas"),n=e.getContext("2d");e.width=t.width,e.height=t.height,n.drawImage(t,0,0),this.resetBoard();const o=(t.height/20+t.width/10)/2-.3;for(let t=0;t<l.NUM_COLUMN;t++)for(let e=0;e<l.NUM_ROW;e++){const r=Math.round((t+.5)*o),i=Math.round((e+.5)*o),a=n.getImageData(r,i,1,1).data;Math.max(a[0],a[1],a[2])>60?this.board[e][t]=l.SquareState.color1:this.board[e][t]=l.SquareState.EMPTY,n.fillStyle="GREEN",n.fillRect(r,i,5,5)}!function(t){let e=!1;for(let n=l.NUM_ROW-1;n>=0;n--)if(e)for(let e=0;e<l.NUM_COLUMN;e++)t[n][e]=l.SquareState.EMPTY;else{let o=!0;for(let e=0;e<l.NUM_COLUMN;e++)if(t[n][e]!=l.SquareState.EMPTY){o=!1;break}o&&(e=!0)}}(this.board),S=JSON.parse(JSON.stringify(this.board)),this.canvas.drawBoard(),h=!0};const g=document.getElementById("main-canvas"),p=g.getContext("2d"),I=n(1);function m(t){this.board=t}function _(t,e,n){return e<0||e>=l.NUM_COLUMN||t<0||t>=l.NUM_ROW||n[t][e]!=l.SquareState.EMPTY}function R(t,e,n){for(let o=0;o<l.NUM_COLUMN;o++)n[t][o]==l.SquareState.EMPTY&&(p.fillStyle=e,p.fillRect(o*l.SQUARE_SIZE+l.PIXEL_SIZE,t*l.SQUARE_SIZE+l.PIXEL_SIZE,l.SQUARE_SIZE-3*l.PIXEL_SIZE,l.SQUARE_SIZE-3*l.PIXEL_SIZE))}function L(t,e){this.rotationList=t[0],this.colorId=t[1],this.id=t[2],this.board=e,this.rotationIndex=0,this.activeTetromino=this.rotationList[this.rotationIndex],this.x=3,this.y="I"==this.id?-2:-1}g.setAttribute("height",l.SQUARE_SIZE*l.NUM_ROW),g.setAttribute("width",l.SQUARE_SIZE*(l.NUM_COLUMN+7)),m.prototype.drawLineClears=function(t,e){if(e>=15)return;const n=5+Math.floor(e/3),o=9-n;for(const e of t)p.fillStyle="black",p.fillRect(o*l.SQUARE_SIZE,e*l.SQUARE_SIZE,l.SQUARE_SIZE,l.SQUARE_SIZE),p.fillRect(n*l.SQUARE_SIZE,e*l.SQUARE_SIZE,l.SQUARE_SIZE,l.SQUARE_SIZE)},m.prototype.drawSquare=function(t,e,n,o=!1){if(n==l.VACANT)return p.fillStyle="black",void p.fillRect(t*l.SQUARE_SIZE,e*l.SQUARE_SIZE,l.SQUARE_SIZE,l.SQUARE_SIZE);p.fillStyle=n,p.fillRect(t*l.SQUARE_SIZE,e*l.SQUARE_SIZE,7*l.PIXEL_SIZE,7*l.PIXEL_SIZE),o&&n!==l.VACANT&&(p.fillStyle="white",p.fillRect(t*l.SQUARE_SIZE+l.PIXEL_SIZE,e*l.SQUARE_SIZE+l.PIXEL_SIZE,5*l.PIXEL_SIZE,5*l.PIXEL_SIZE)),n!==l.VACANT&&(p.fillStyle="white",p.fillRect(t*l.SQUARE_SIZE,e*l.SQUARE_SIZE,l.PIXEL_SIZE,l.PIXEL_SIZE),p.fillRect(t*l.SQUARE_SIZE+l.PIXEL_SIZE,e*l.SQUARE_SIZE+l.PIXEL_SIZE,l.PIXEL_SIZE,l.PIXEL_SIZE),p.fillRect(t*l.SQUARE_SIZE+l.PIXEL_SIZE+l.PIXEL_SIZE,e*l.SQUARE_SIZE+l.PIXEL_SIZE,l.PIXEL_SIZE,l.PIXEL_SIZE),p.fillRect(t*l.SQUARE_SIZE+l.PIXEL_SIZE,e*l.SQUARE_SIZE+l.PIXEL_SIZE+l.PIXEL_SIZE,l.PIXEL_SIZE,l.PIXEL_SIZE))},m.prototype.drawNextBox=function(t){const e=l.NUM_COLUMN+1;if(p.fillStyle="BLACK",p.fillRect(e*l.SQUARE_SIZE,8*l.SQUARE_SIZE,5*l.SQUARE_SIZE,4.5*l.SQUARE_SIZE),null!=t){const n="I"===t.id||"O"===t.id?e+.5:e,o="I"===t.id?7.75:8.25,r=l.COLOR_PALETTE[t.colorId][Et()%10];for(let e=0;e<t.activeTetromino.length;e++)for(let i=0;i<t.activeTetromino[e].length;i++)t.activeTetromino[e][i]&&this.drawSquare(n+i,o+e,r,1===t.colorId)}},m.prototype.drawScoreDisplay=function(t){const e=5*l.SQUARE_SIZE,n=l.BOARD_WIDTH+l.SQUARE_SIZE,o=.5*l.SQUARE_SIZE,r=("0".repeat(6)+t).slice(-6);this.drawMultiLineText(["SCORE",r],n,o,e,"center")},m.prototype.drawLinesDisplay=function(t){const e=l.NEXT_BOX_WIDTH,n=l.BOARD_WIDTH+l.SQUARE_SIZE,o=3*l.SQUARE_SIZE,r=("0".repeat(3)+t).slice(-3);this.drawMultiLineText(["LINES",r],n,o,e,"center")},m.prototype.drawLevelDisplay=function(t){const e=l.NEXT_BOX_WIDTH,n=l.BOARD_WIDTH+l.SQUARE_SIZE,o=14*l.SQUARE_SIZE,r=("0".repeat(2)+t).slice(-2);this.drawMultiLineText(["LEVEL",r],n,o,e,"center")},m.prototype.drawPieceStatusDisplay=function(t){const e=l.NEXT_BOX_WIDTH,n=l.BOARD_WIDTH+l.SQUARE_SIZE,o=6*l.SQUARE_SIZE;this.drawMultiLineText(t,n,o,e,"center")},m.prototype.drawMultiLineText=function(t,e,n,o,r){p.clearRect(e,n,o,20*t.length),p.textAlign="center",p.font="18px 'Press Start 2P'",p.fillStyle="BLACK";const i="center"==r?o/2:0;let a=0;for(let o of t)p.fillText(o.toUpperCase(),e+i,n+20*(a+1)),a++},m.prototype.drawPiece=function(t){if(null==t)return;const e=Et(),n="T"===t.id||"O"===t.id||"I"===t.id;for(let o=0;o<t.activeTetromino.length;o++)for(let r=0;r<t.activeTetromino[o].length;r++)t.activeTetromino[o][r]&&(0!==t.colorId?this.drawSquare(t.x+r,t.y+o,l.COLOR_PALETTE[t.colorId][e%10],n):this.drawSquare(t.x+r,t.y+o,l.VACANT,n))},m.prototype.unDrawPiece=function(t){if(null!=t)for(let e=0;e<t.activeTetromino.length;e++)for(let n=0;n<t.activeTetromino[e].length;n++)t.activeTetromino[e][n]&&this.drawSquare(t.x+n,t.y+e,l.VACANT,!1)},m.prototype.drawCurrentPiece=function(){this.drawPiece(St())},m.prototype.unDrawCurrentPiece=function(){this.unDrawPiece(St())},m.prototype.drawBoard=function(){const t=Et();for(let e=0;e<l.NUM_ROW;e++)for(let n=0;n<l.NUM_COLUMN;n++){let o=this.board[e][n];0!==o?this.drawSquare(n,e,l.COLOR_PALETTE[o][t%10],1===o):this.drawSquare(n,e,l.VACANT,1===o)}I.ShouldShowDiggingHints()&&this.drawDiggingHints()},m.prototype.drawDiggingHints=function(){const t=function(t){for(let e=0;e<l.NUM_ROW;e++)for(let n=0;n<l.NUM_COLUMN;n++)if(t[e][n]==l.SquareState.EMPTY&&_(e-1,n,t)&&_(e+1,n,t)&&_(e,n-1,t)&&_(e,n+1,t))return[e,n];return[]}(this.board),e=function(t){let e=l.NUM_ROW-1,n=[];for(;!_(e,l.NUM_COLUMN-1,t);)e--;for(;e>=0&&_(e,l.NUM_COLUMN-1,t);)n.push(e),e--;return n}(this.board);if(t.length>0){const e=t[0],n=t[1];let o=[],r=e-1;for(;r>=0&&_(r,n,this.board);)o.push(r),r-=1;const i=(e+.45)*l.SQUARE_SIZE,a=(n+.45)*l.SQUARE_SIZE,s=l.SQUARE_SIZE/4;p.fillStyle="yellow",p.beginPath(),p.arc(a,i,s,0,2*Math.PI,!1),p.fill();for(let t of o)R(t,"#842424",this.board)}else if(e.length>0)for(let t of e)R(t,"#215E30",this.board)},L.prototype.equals=function(t){return this.id===t.id},L.prototype.getHeightFromBottom=function(){let t=0;for(let e=0;e<this.activeTetromino.length;e++)for(let n=0;n<this.activeTetromino[e].length;n++)this.activeTetromino[e][n]&&(t=Math.max(t,this.y+e));return l.NUM_ROW-t},L.prototype.shouldLock=function(){return this.collision(0,1,this.activeTetromino)},L.prototype.moveDown=function(){this.y++},L.prototype.moveRight=function(){return!this.collision(1,0,this.activeTetromino)&&(this.x++,!0)},L.prototype.moveLeft=function(){return!this.collision(-1,0,this.activeTetromino)&&(this.x--,!0)},L.prototype.rotate=function(t){const e=t?1:-1,n=(this.rotationIndex+e+this.rotationList.length)%this.rotationList.length,o=this.rotationList[n];this.collision(0,0,o)||(this.rotationIndex=n,this.activeTetromino=this.rotationList[this.rotationIndex])},L.prototype.lock=function(){for(let t=0;t<this.activeTetromino.length;t++)for(let e=0;e<this.activeTetromino[t].length;e++){if(!this.activeTetromino[t][e])continue;const n=this.y+t,o=this.x+e;n>=0&&n<l.NUM_ROW&&o>=0&&o<l.NUM_COLUMN&&(this.board[this.y+t][this.x+e]=this.colorId)}},L.prototype.collision=function(t,e,n){for(let o=0;o<n.length;o++)for(let r=0;r<n[o].length;r++){if(!n[o][r])continue;let i=this.x+r+t,a=this.y+o+e;if(i<0||i>=l.NUM_COLUMN||a>=l.NUM_ROW)return!0;if(!(a<0)&&0!=this.board[a][i])return!0}return!1};const y=n(1),A=document.getElementById("debug");function T(t,e,n,o,r,i,a,s){this.resetLocalVariables(),this.togglePauseFunc=i,this.moveDownFunc=t,this.moveLeftFunc=e,this.moveRightFunc=n,this.rotateLeftFunc=o,this.rotateRightFunc=r,this.getGameStateFunc=a,this.getAREFunc=s}function D(t){return t==l.GameState.RUNNING||t==l.GameState.FIRST_PIECE}T.prototype.getIsSoftDropping=function(){return this.isSoftDropping},T.prototype.getCellsSoftDropped=function(){return this.cellSoftDropped},T.prototype.onPieceLock=function(){y.IsDASAlwaysCharged()&&this.setDASCharge(y.GetDASTriggerThreshold())},T.prototype.resetLocalVariables=function(){this.leftHeld=!1,this.rightHeld=!1,this.downHeld=!1,this.isSoftDropping=!1,this.cellSoftDropped=0,this.dasCharge=y.GetDASTriggerThreshold(),this.softDroppedLastFrame=!1},T.prototype.handleInputsThisFrame=function(){if(this.downHeld+this.leftHeld+this.rightHeld>1)return this.isSoftDropping=!1,void(this.cellSoftDropped=0);if(this.isSoftDropping&&!this.softDroppedLastFrame){return this.moveDownFunc()?this.cellSoftDropped+=1:(this.isSoftDropping=!1,this.cellSoftDropped=0),void(this.softDroppedLastFrame=!0)}this.softDroppedLastFrame=!1,this.leftHeld?this.handleHeldDirection(l.Direction.LEFT):this.rightHeld&&this.handleHeldDirection(l.Direction.RIGHT)},T.prototype.keyDownListener=function(t){if(!t.repeat){switch(t.keyCode){case 37:this.leftHeld=!0;break;case 39:this.rightHeld=!0;break;case 40:this.downHeld=!0}if(D(this.getGameStateFunc()))switch(t.keyCode){case 37:this.handleTappedDirection(l.Direction.LEFT);break;case 39:this.handleTappedDirection(l.Direction.RIGHT);break;case 90:this.rotateLeftFunc();break;case 88:this.rotateRightFunc();break;case 40:this.isSoftDropping=!0}else switch(t.keyCode){case 90:case 88:console.log("rotate rejected, state: ",this.getGameStateFunc())}80==t.keyCode&&this.togglePauseFunc()}},T.prototype.keyUpListener=function(t){37==t.keyCode?this.leftHeld=!1:39==t.keyCode?this.rightHeld=!1:40==t.keyCode&&(this.downHeld=!1,this.isSoftDropping=!1,this.cellSoftDropped=0)},T.prototype.tryShiftPiece=function(t){const e=t==l.Direction.LEFT?this.moveLeftFunc():this.moveRightFunc();return e||this.setDASCharge(y.GetDASTriggerThreshold()),e},T.prototype.handleHeldDirection=function(t){const e=y.GetDASTriggerThreshold();if(this.setDASCharge(Math.min(e,this.dasCharge+1)),this.dasCharge==e){this.tryShiftPiece(t)&&this.setDASCharge(y.GetDASChargedFloor())}},T.prototype.handleTappedDirection=function(t){D(this.getGameStateFunc())&&(this.setDASCharge(y.GetDASUnchargedFloor()),this.tryShiftPiece(t))},T.prototype.setDASCharge=function(t){this.dasCharge=t,this.refreshDebugText()},T.prototype.refreshDebugText=function(){let t="",e="";for(let t=0;t<this.dasCharge;t++)e+="x";0==this.dasCharge&&(e="."),t+="DAS: "+this.dasCharge+"\n"+e,A.innerText=t};const U=document.getElementById("main-canvas");function N(t,e){this.board=t,this.canvas=e,this.mouseIsDown=!1,this.squaresToggled=new Set,this.dragMode=M.NONE}const M=Object.freeze({ADDING:"adding",REMOVING:"removing",NONE:"none"});function P(t){const e=U.getBoundingClientRect(),n=t.clientX-e.left,o=t.clientY-e.top;return[Math.floor(o/l.SQUARE_SIZE),Math.floor(n/l.SQUARE_SIZE)]}function C(t,e){return t+","+e}N.prototype.toggleCell=function(t,e){this.squaresToggled.add(C(t,e)),this.board[t][e]=this.board[t][e]==l.SquareState.EMPTY?l.SquareState.COLOR1:l.SquareState.EMPTY,this.canvas.drawBoard(),this.canvas.drawCurrentPiece()},N.prototype.onMouseDown=function(t){let e,n;[e,n]=P(t),this.mouseIsDown=!0,this.dragMode=this.board[e][n]==l.SquareState.EMPTY?M.ADDING:M.REMOVING,this.toggleCell(e,n)},N.prototype.onMouseDrag=function(t){if(!this.mouseIsDown)return;let e,n;[e,n]=P(t);(this.dragMode==M.ADDING?this.board[e][n]==l.SquareState.EMPTY:this.board[e][n]!=l.SquareState.EMPTY)&&!this.squaresToggled.has(C(e,n))&&this.toggleCell(e,n)},N.prototype.onMouseUp=function(t){this.mouseIsDown=!1,this.squaresToggled=new Set};const{NUM_COLUMN:w,NUM_ROW:O,SquareState:b}=n(0);function v(t,e){this.board=t}function Z(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1))+t}v.prototype.loadEmptyBoard=function(){for(let t=0;t<O;t++)for(let e=0;e<w;e++)this.board[t][e]=b.EMPTY},v.prototype.loadStandardBoard=function(){this.loadEmptyBoard();let t=Z(6,10);for(let e=0;e<w-1;e++){const n=Math.min(12,Math.max(0,t));for(let t=O-n-1;t<O;t++){const n=t%3,o=[b.COLOR1,b.COLOR2,b.COLOR3][n];this.board[t][e]=o}t+=Z(-2,1)}};const B=.5,G=.4;v.prototype.loadDigBoard=function(){this.loadStandardBoard();for(let t=0;t<O;t++){let e;const n=Math.random();e=n<B?0:n<B+G?1:2;for(let n=0;n<e;n++)this.board[t][Z(0,w)]=b.EMPTY}};const x=document.getElementById("main-canvas"),Q=document.getElementById("left-panel-toggle-button"),F=document.getElementById("left-panel");document.getElementById("right-panel");let H=!0;F.style.minHeight=l.BOARD_HEIGHT+60,x.setAttribute("height",l.BOARD_HEIGHT),x.setAttribute("width",l.DISPLAY_FULL_WIDTH),Q.innerText="<",Q.addEventListener("click",(function(t){H=!H,H?(F.style.marginLeft=0,Q.innerText="<"):(F.style.marginLeft=-290,Q.innerText=">")}));const k=n(1),X=(document.getElementById("score-display"),document.getElementById("lines-display"),document.getElementById("level-display"),document.getElementById("header-text")),q=document.getElementById("stats"),W=(document.getElementById("game-options-form"),document.getElementById("start-game"),document.getElementById("restart-game"),document.getElementById("level-select")),Y=document.getElementById("main-canvas"),V=document.getElementById("right-panel");let j,J=[];for(let t=0;t<l.NUM_ROW;t++){J[t]=[];for(let e=0;e<l.NUM_COLUMN;e++)J[t][e]=l.SquareState.EMPTY}let $,z,K,tt,et,nt,ot,rt,it,at,st,ct,ut,lt=new m(J),dt=new N(J,lt),ft=new v(J),ht=new u;new E(J,lt);const St=()=>$,Et=()=>K;function gt(){let t="";switch(nt){case l.GameState.START_SCREEN:t="Welcome to Tetris Trainer!";break;case l.GameState.RUNNING:t="";break;case l.GameState.GAME_OVER:t="Game over!";break;case l.GameState.PAUSED:t="Paused"}X.innerText=t}function pt(){const t=function(t,e){let n=0;for(let o=0;o<l.NUM_ROW;o++)for(let r=t;r<e;r++)if(J[o][r]!=l.SquareState.EMPTY){n+=(o+r)%2==0?1:-1}return Math.abs(n)},e=t(0,5),n=t(3,7),o=t(5,10);q.innerText=`Parity: \nL=${e} \nM=${n} \nR=${o}`}function It(){$=z,lt.drawPieceStatusDisplay(ht.getStatusDisplay()),z=new L(ht.chooseNextPiece($.id),J),lt.drawNextBox(z)}function mt(){ot=0,rt=0,it=0,at=0,ct=[],ut=0,tt=0,K=0,nt=l.GameState.START_SCREEN,j.resetLocalVariables()}function _t(){nt==l.GameState.FIRST_PIECE&&0==st?nt=l.GameState.RUNNING:nt==l.GameState.LINE_CLEAR&&0==at?nt=l.GameState.ARE:nt==l.GameState.ARE&&0==it?(ot+=ut,ut=0,Rt(),lt.drawCurrentPiece(),!function(){const t=$.activeTetromino;for(let e=0;e<t.length;e++)for(let n=0;n<t[e].length;n++)if(t[e][n]&&J[$.y+e][$.x+n])return!0;return!1}()?nt=l.GameState.RUNNING:(nt=l.GameState.GAME_OVER,gt())):nt==l.GameState.RUNNING&&(at>0?nt=l.GameState.LINE_CLEAR:it>0&&(nt=l.GameState.ARE))}function Rt(){console.log("refreshing score display"),lt.drawLevelDisplay(K),lt.drawScoreDisplay(ot),lt.drawLinesDisplay(tt)}function Lt(){if($.shouldLock()){const t=$.getHeightFromBottom();return $.lock(),j.onPieceLock(),lt.drawBoard(),pt(),It(),ct=function(){let t=[];for(let e=0;e<l.NUM_ROW;e++){let n=!0;for(let t=0;t<l.NUM_COLUMN;t++)if(J[e][t]==l.SquareState.EMPTY){n=!1;break}n&&t.push(e)}return t}(),ct.length>0&&(at=l.LINE_CLEAR_DELAY),ut+=Object(l.CalculatePushdownPoints)(j.getCellsSoftDropped()),it=10+2*Math.floor((t+2)/4),!1}return lt.unDrawCurrentPiece(),$.moveDown(),lt.drawCurrentPiece(),!0}j=new T(Lt,(function(){lt.unDrawCurrentPiece();const t=$.moveLeft();return lt.drawCurrentPiece(),t}),(function(){lt.unDrawCurrentPiece();const t=$.moveRight();return lt.drawCurrentPiece(),t}),(function(){lt.unDrawCurrentPiece(),$.rotate(!1),lt.drawCurrentPiece()}),(function(){lt.unDrawCurrentPiece(),$.rotate(!0),lt.drawCurrentPiece()}),(function(){nt==l.GameState.RUNNING||nt==l.GameState.FIRST_PIECE?(nt=l.GameState.PAUSED,gt()):nt==l.GameState.PAUSED&&(nt=l.GameState.RUNNING,gt())}),(function(){return nt}),(function(){return it})),Y.addEventListener("mousedown",(function(t){dt.onMouseDown(t)})),Y.addEventListener("mousemove",(function(t){dt.onMouseDrag(t)})),Y.addEventListener("mouseup",(function(t){dt.onMouseUp(t)})),V.addEventListener("mouseleave",(function(t){dt.onMouseUp(t)})),document.addEventListener("keydown",t=>{j.keyDownListener(t)}),document.addEventListener("keyup",t=>{j.keyUpListener(t)}),document.getElementById("preset-standard").addEventListener("click",t=>{ft.loadEmptyBoard(),lt.drawBoard()}),document.getElementById("preset-random-board").addEventListener("click",t=>{ft.loadStandardBoard(),lt.drawBoard()}),document.getElementById("preset-dig-practice").addEventListener("click",t=>{ft.loadDigBoard(),lt.drawBoard()}),document.getElementById("start-button").addEventListener("click",t=>{t.preventDefault(),Y.focus(),ft.loadEmptyBoard(),lt.drawBoard(),function(){mt(),st=30,ht.startReadingPieceSequence(),nt=l.GameState.FIRST_PIECE;const t=parseInt(W.value);var e;K=Number.isInteger(t)&&t>0?t:0,et=k.ShouldTransitionEvery10Lines()?10:(e=K)<10?10*(e+1):e<=15?100:10*(e-5),z=new L(ht.chooseNextPiece(""),J),It(),lt.drawBoard(),lt.drawCurrentPiece(),gt(),Rt()}()}),mt(),lt.drawBoard(),lt.drawNextBox(null),gt(),pt(),Rt(),function t(){const e=Date.now();switch(nt){case l.GameState.FIRST_PIECE:st-=1;break;case l.GameState.LINE_CLEAR:at-=1,lt.drawLineClears(ct,l.LINE_CLEAR_DELAY-at),0==at&&function(){const t=ct.length;for(const t of ct){for(let e=t;e>1;e--)for(let t=0;t<l.NUM_COLUMN;t++)J[e][t]=J[e-1][t];for(let t=0;t<l.NUM_COLUMN;t++)J[0][t]=l.SquareState.EMPTY}ct=[],t>0&&(tt+=t,(k.ShouldTransitionEveryLine()||tt>=et)&&(K+=1,et+=10),ut+=l.REWARDS[t]*(K+1),lt.drawBoard(),lt.drawNextBox(z))}();break;case l.GameState.ARE:it-=1;break;case l.GameState.RUNNING:j.handleInputsThisFrame(),j.getIsSoftDropping()?rt=0:(rt+=1,rt>=Object(l.GetGravity)(K)&&(Lt(),rt=0))}_t();const n=Date.now()-e;window.setTimeout(t,16.67-n)}()}]);